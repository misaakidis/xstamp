<!doctype html>
<html lang="el">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Social -->
    <meta property="og:description" content="Stamp duty service">
    <meta property="og:title" content="XStamp - gov.cy">
    <meta property="og:url" content="https://xstamp.gov.cy">
    <meta property="og:type" content="website">
    <meta property="og:image" content="img/icon-512.png">
    <meta property="og:site_name" content="gov.cy">
 
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https:/xstamp.gov.cy">
    <meta property="twitter:title" content="XStamp - gov.cy">
    <meta property="twitter:description" content="Stamp duty service">
    <meta property="twitter:image" content="img/icons-512.png">
 
    <!-- Theme --> 
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#31576F">
    <link rel="icon" type="image/png" sizes="48x48" href="img/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
 
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144x144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="img/apple-touch-icon-120x120-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="img/apple-touch-icon-57x57-precomposed.png">
 
    <!-- CSS -->
    <link href="css/govcymain.min.css" rel="stylesheet" >
    
    <title>XStamp - gov.cy</title>
    <meta name="description" content="Stamp duty service">
 
 
  </head>
  <body class="d-flex flex-column min-vh-100">
    <a href="#mainContainer" class="govcy-skip-link">Skip to main content</a>
    <!--bodyStart-->
    <!-- <section  class="govcy-container-fluid" id="bodyStartContainer"> </section> -->


    <!--Header-->
    <section id="headerContainer" class="govcy-container-fluid govcy-m-0 govcy-position-relative govcy-d-print-none">
        <div class="row">
            <header class="govcy-header govcy-bg-primary govcy-text-white govcy-bg-primary-right">
                <a href="index.html" class="govcy-logo"> <img></a>
                <!-- <form class="govcy-text-white govcy-bg-primary" novalidate>     
                    <select name="govcy-lang-menu" class="govcy-lang-menu govcy-text-white">
                        <option value="English">English</option>
                        <option value="Greek">Ελληνικά</option>
                    </select>
                </form> -->
                <input class="govcy-menu-btn govcy-d-none" type="checkbox" id="menu-btn">
                <label class="govcy-menu-icon govcy-d-md-none" for="menu-btn">Menu
                    <span class="material-icons govcy-my-3">arrow_drop_down</span>
                </label>
                <span class="govcy-service-name">XStamp</span>
                <ul class="govcy-menu govcy-bg-sub-menu govcy-bg-md-primary">
                    <li><a class="active" href="issue.html">Issue XStamp</a></li>
                    <li><a class="active" href="verify.html">Verify XStamp</a></li>
                    <!-- <li><a class="active" href="help.html">Help</a></li> -->
                </ul>
            </header>
        </div>
    </section>



    <!-- beforeMain-->
    <section class="govcy-container govcy-mb-4" id="beforeMainContainer">
        <div class="govcy-float-start">
            <a href="index.html" class="govcy-back-link">Home</a>
            <!-- <span class="bi bi-chevron-right"></span>
            <a href="/issue.html" class="govcy-back-link">Issue XStamp</a> -->
            <span class="bi bi-chevron-right"></span>
            <span>Issue XStamp</span>
        </div>    
    </section>


    <!-- https://www.mof.gov.cy/mof/TAX/taxdep.nsf/All/36632505320CE77BC22585BD0038E24B/$file/23_07_10%20stamps.xlsm?OpenElement -->
    <!--main-->
    <main class="flex-grow-1 govcy-container govcy-my-2" id="mainContainer">

        <div class="row">
            <article class="govcy-col-8">
              <form action="" class="govcy-form" novalidate="">
                <fieldset class="govcy-fieldset govcy-mb-4">
                    <legend><h1>Issue XStamp</h1></legend>
                    <div class="govcy-form-control">
                        <label class="govcy-label govcy-mb-1" for="infile">Select the agreement to be stamped</label>
                            <span class="govcy-hint" id="infile_hint">The agreement is stored on your browser and is not uploaded to the Internet.</span>
                            <input class="govcy-file-upload" type="file" id="infile" name="infile" aria-describedby="infile_hint">
                    </div> 
                    <div class="govcy-form-control">
                        <label class="govcy-label" for="in7">Stamp duty amount</label>
                        <input type="text" class="govcy-text-input govcy-text-input-char_10" placeholder="Amount in Euro" maxlength="10" id="amount">
                        <details class="govcy-details">
                            <summary class="govcy-details__summary">
                                <span class="govcy-details__summary-text">How to compute the price of your stamp duties</span>
                            </summary>
                            <p class="govcy-details__text">
                                The Republic of Cyprus is using an Excel document with macros for the computation of stamp duties. You can download the document from the <a href="https://www.mof.gov.cy/mof/TAX/taxdep.nsf/All/36632505320CE77BC22585BD0038E24B/$file/23_07_10%20stamps.xlsm?OpenElement">Ministry of Finance website</a>.
                            </p>
                        </details>
                    </div>
                </fieldset>
                <button type="button" class="govcy-btn-primary govcy-mb-4" id="btn-continue">Continue</button>
              </form>
            </article>
        </div>

            
    </main>


    <!-- Footer -->
    <section style="margin-top: auto;" class="govcy-container-fluid govcy-br-top-8 govcy-br-top-primary govcy-p-3 govcy-bg-light govcy-d-print-none">
        <div class="govcy-container" id="footerContainer"></div>
            <div class="row">   
                <footer class="govcy-footer">
                    <span class="govcy-d-inline-block govcy-valign-top govcy-pb-2"><img alt="govcy-logo"></span>
                            <ul class="govcy-d-inline-block  govcy-m-0 govcy-pl-3 govcy-efs-medium">
                            <li><a href="#">Privacy statement</a></li>
                            <li><a href="#">Cookie policy</a></li>
                            <li><a href="#">Accessibility statement</a></li>
                            <li class="govcy-d-block govcy-text-dark">This project is developed in the context of the Odyssey XRPL hackathon and is not associated with the Republic of Cyprus.</li>
                        </ul>
                </footer>
            </div>
        </div>
    </section>


    <!--bodyEnd-->
    <section  class="govcy-container-fluid" id="bodyEndContainer"> </section>

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/gov-cy/govcy-design-system@v2.1.1/dist/js/app.min.js" integrity="sha384-xv0o+su1i+C0o4fYwrsX+q0dhbhj/IsZscMn7qvrt49Wboy+TIWT0GlfyiW39aH/" crossorigin="anonymous"></script>

    <script>
        const endpoint = 'https://xstamp-6a71aaea13f1.herokuapp.com';

        document.getElementById('btn-continue').addEventListener('click', async () => {
        const fileInput = document.getElementById('infile');
        const amountInput = document.getElementById('amount');

        if (fileInput.files.length === 0 || amountInput.value === '') {
            alert('Please select a file and enter the amount.');
            return;
        }

        const file = fileInput.files[0];
        const amount = amountInput.value;

        try {
            const hash = await generateFileHash(file);
            const payload = { hash: hash, amount: amount };

            const response = await fetch(endpoint + '/issue-stamp', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                // Handle successful response
                const resultData = await response.json();
                console.log('Success:', resultData);


                // Redirect to /view-stamp and pass resultData as a query parameter
                const redirectURL = `view.html?result=${encodeURIComponent(JSON.stringify(resultData))}`;
                window.location.href = redirectURL;
            } else {
                // Handle error response
                console.error('Error:', response.statusText);
            }
        } catch (error) {
            console.error('Error:', error);
        }
    });

    async function generateFileHash(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = async (event) => {
                try {
                    const hashBuffer = await crypto.subtle.digest('SHA-256', event.target.result);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                    resolve(hashHex);
                } catch (error) {
                    reject(error);
                }
            };
            reader.onerror = () => {
                reader.abort();
                reject(new DOMException("Problem parsing input file."));
            };

            reader.readAsArrayBuffer(file);
        });
    }

    </script>
  </body>
</html>